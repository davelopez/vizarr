{"version":3,"file":"index-D8Wgv3yG.js","sources":["../node_modules/.pnpm/just-debounce-it@3.2.0/node_modules/just-debounce-it/index.mjs","../main.ts"],"sourcesContent":["var functionDebounce = debounce;\n\nfunction debounce(fn, wait, callFirst) {\n  var timeout = null;\n  var debouncedFn = null;\n\n  var clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n\n      debouncedFn = null;\n      timeout = null;\n    }\n  };\n\n  var flush = function() {\n    var call = debouncedFn;\n    clear();\n\n    if (call) {\n      call();\n    }\n  };\n\n  var debounceWrapper = function() {\n    if (!wait) {\n      return fn.apply(this, arguments);\n    }\n\n    var context = this;\n    var args = arguments;\n    var callNow = callFirst && !timeout;\n    clear();\n\n    debouncedFn = function() {\n      fn.apply(context, args);\n    };\n\n    timeout = setTimeout(function() {\n      timeout = null;\n\n      if (!callNow) {\n        var call = debouncedFn;\n        debouncedFn = null;\n\n        return call();\n      }\n    }, wait);\n\n    if (callNow) {\n      return debouncedFn();\n    }\n  };\n\n  debounceWrapper.cancel = clear;\n  debounceWrapper.flush = flush;\n\n  return debounceWrapper;\n}\n\nexport {functionDebounce as default};\n","import debounce from \"just-debounce-it\";\nimport * as vizarr from \"./src/index\";\n\nasync function main() {\n  console.log(`vizarr v${vizarr.version}: https://github.com/hms-dbmi/vizarr`);\n  // biome-ignore lint/style/noNonNullAssertion: We know the element exists\n  const viewer = await vizarr.createViewer(document.querySelector(\"#root\")!);\n  const url = new URL(window.location.href);\n\n  if (!url.searchParams.has(\"source\")) {\n    return;\n  }\n\n  // see if we have initial viewState\n  const viewStateString = url.searchParams.get(\"viewState\");\n  if (viewStateString) {\n    const viewState = JSON.parse(viewStateString);\n    viewer.setViewState(viewState);\n  }\n\n  // Add event listener to sync viewState as query param.\n  // Debounce to limit how quickly we are pushing to browser history\n  viewer.on(\n    \"viewStateChange\",\n    debounce((update: vizarr.ViewState) => {\n      const url = new URL(window.location.href);\n      url.searchParams.set(\"viewState\", JSON.stringify(update));\n      window.history.pushState({}, \"\", decodeURIComponent(url.href));\n    }, 200),\n  );\n\n  // parse image config\n  // @ts-expect-error - TODO: validate config\n  const config: vizarr.ImageLayerConfig = {};\n\n  for (const [key, value] of url.searchParams) {\n    // @ts-expect-error - TODO: validate config\n    config[key] = value;\n  }\n\n  // Make sure the source URL is decoded.\n  viewer.addImage(config);\n\n  const newLocation = decodeURIComponent(url.href);\n\n  // Only update history if the new loacation is different from the current\n  if (window.location.href !== newLocation) {\n    window.history.pushState(null, \"\", newLocation);\n  }\n}\n\nmain();\n"],"names":["functionDebounce","debounce","fn","wait","callFirst","timeout","debouncedFn","clear","flush","call","debounceWrapper","context","args","callNow","main","vizarr.version","viewer","vizarr.createViewer","url","viewStateString","viewState","update","config","key","value","newLocation"],"mappings":"uwBAAA,IAAIA,EAAmBC,EAEvB,SAASA,EAASC,EAAIC,EAAMC,EAAW,CACrC,IAAIC,EAAU,KACVC,EAAc,KAEdC,EAAQ,UAAW,CACjBF,IACF,aAAaA,CAAO,EAEpBC,EAAc,KACdD,EAAU,KAEhB,EAEMG,EAAQ,UAAW,CACrB,IAAIC,EAAOH,EACXC,IAEIE,GACFA,GAEN,EAEMC,EAAkB,UAAW,CAC/B,GAAI,CAACP,EACH,OAAOD,EAAG,MAAM,KAAM,SAAS,EAGjC,IAAIS,EAAU,KACVC,EAAO,UACPC,EAAUT,GAAa,CAACC,EAkB5B,GAjBAE,IAEAD,EAAc,UAAW,CACvBJ,EAAG,MAAMS,EAASC,CAAI,CAC5B,EAEIP,EAAU,WAAW,UAAW,CAG9B,GAFAA,EAAU,KAEN,CAACQ,EAAS,CACZ,IAAIJ,EAAOH,EACX,OAAAA,EAAc,KAEPG,EAAI,CACZ,CACF,EAAEN,CAAI,EAEHU,EACF,OAAOP,EAAW,CAExB,EAEE,OAAAI,EAAgB,OAASH,EACzBG,EAAgB,MAAQF,EAEjBE,CACT,CCvDA,eAAeI,GAAO,CACpB,QAAQ,IAAI,WAAWC,CAAc,sCAAsC,EAE3E,MAAMC,EAAS,MAAMC,EAAoB,SAAS,cAAc,OAAO,CAAE,EACnEC,EAAM,IAAI,IAAI,OAAO,SAAS,IAAI,EAExC,GAAI,CAACA,EAAI,aAAa,IAAI,QAAQ,EAChC,OAIF,MAAMC,EAAkBD,EAAI,aAAa,IAAI,WAAW,EACxD,GAAIC,EAAiB,CACb,MAAAC,EAAY,KAAK,MAAMD,CAAe,EAC5CH,EAAO,aAAaI,CAAS,CAC/B,CAIOJ,EAAA,GACL,kBACAf,EAAUoB,GAA6B,CACrC,MAAMH,EAAM,IAAI,IAAI,OAAO,SAAS,IAAI,EACxCA,EAAI,aAAa,IAAI,YAAa,KAAK,UAAUG,CAAM,CAAC,EACjD,OAAA,QAAQ,UAAU,CAAC,EAAG,GAAI,mBAAmBH,EAAI,IAAI,CAAC,GAC5D,GAAG,CAAA,EAKR,MAAMI,EAAkC,CAAA,EAExC,SAAW,CAACC,EAAKC,CAAK,IAAKN,EAAI,aAE7BI,EAAOC,CAAG,EAAIC,EAIhBR,EAAO,SAASM,CAAM,EAEhB,MAAAG,EAAc,mBAAmBP,EAAI,IAAI,EAG3C,OAAO,SAAS,OAASO,GAC3B,OAAO,QAAQ,UAAU,KAAM,GAAIA,CAAW,CAElD,CAEAX,EAAK","x_google_ignoreList":[0]}