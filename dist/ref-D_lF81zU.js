var v=t=>{throw TypeError(t)};var A=(t,r,n)=>r.has(t)||v("Cannot "+n);var m=(t,r,n)=>(A(t,r,"read from private field"),n?n.call(t):r.get(t)),p=(t,r,n)=>r.has(t)?v("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(t):r.set(t,n),y=(t,r,n,e)=>(A(t,r,"write to private field"),e?e.call(t,n):r.set(t,n),n);import{strip_prefix as j,fetch_range as k,merge_init as $,uri2href as O}from"./vizarr-DdL639xQ.js";function E(t,r=/{{(.*?)}}/){let n=r.exec(t);const e=[];let s;for(;n;)s=n.index,s!==0&&(e.push({match:!1,str:t.substring(0,s)}),t=t.slice(s)),e.push({match:!0,str:n[0]}),t=t.slice(n[0].length),n=r.exec(t);return t&&e.push({match:!1,str:t}),e}function U(t){const r=t.match(/(?<fname>[A-Z_][A-Z_1-9]*)\((?<args>[^)]+)\)/i);if(!(r!=null&&r.groups))return;const{fname:n,args:e}=r.groups,s=Object.fromEntries(e.split(",").map(f=>{var a;const{key:i,num:o,str:c}=((a=f.match(/(?<key>[a-z_0-9]*)\s*=\s*((?<num>[0-9.]+)|('|")(?<str>.*)('|"))/i))==null?void 0:a.groups)??{};if(!i||!(o||c))throw Error(`Failed to match fn kwarg: ${f}`);return[i,o?Number(o):c]}));return{fname:n,ctx:s}}const x="abcdefghijklmnopqrstuvwxyz",_="01234569789",z="()*/+-",M=" ",Z=new Set(x+x.toUpperCase()+_+z+M);function F(t){for(let r=0;r<t.length;r++)if(!Z.has(t.charAt(r)))return;return E(t,/[A-Za-z_][A-Za-z0-9_]*/gi)}function I(t,r){return E(t).map(e=>{if(!e.match)return e.str;let s=e.str.split(/{{|}}/).filter(Boolean)[0].trim();if(s in r)return r[s];const f=U(s);if(f){const{fname:o,ctx:c}=f,a=r[o];if(typeof a=="function")return a(c);throw Error(`Cannot find function named ${o} in rendering context.`)}const i=F(s);if(i){const o=i.map(c=>{if(!c.match)return c.str;const a=r[c.str];if(a==null)throw Error(`Cannot find number named ${c.str} in rendering context.`);if(typeof a!="number")throw Error(`The provided value for ${c.str} must be a number.`);return a});return Function('"use strict";return ('+o.join("")+")")()}throw new Error(`Unable to match ${e.str}`)}).join("")}function N(t,r=I){return"version"in t?T(t,r):S(t)}function S(t){return new Map(Object.entries(t))}function T(t,r){var f;const n={};for(const[i,o]of Object.entries(t.templates??{}))o.includes("{{")?n[i]=c=>r(o,c):n[i]=o;const e=(i,o)=>r(i,{...n,...o}),s=new Map;for(const[i,o]of Object.entries(t.refs??{}))if(typeof o=="string")s.set(i,o);else{const c=(f=o[0])!=null&&f.includes("{{")?e(o[0]):o[0];s.set(i,o.length===1?[c]:[c,o[1],o[2]])}for(const i of t.gen??[])for(const o of q(i.dimensions)){const c=e(i.key,o),a=e(i.url,o);if("offset"in i&&"length"in i){const w=e(i.offset,o),C=e(i.length,o);s.set(c,[a,parseInt(w),parseInt(C)])}else s.set(c,[a])}return s}function*q(t){const r=Object.keys(t),n=Object.values(t).map(e=>Array.isArray(e)?e:[...V(e)]);for(const e of B(...n))yield Object.fromEntries(r.map((s,f)=>[s,e[f]]))}function*B(...t){if(t.length===0)return;const r=t.map(e=>e[Symbol.iterator]()),n=r.map(e=>e.next());if(n.some(e=>e.done))throw new Error("Input contains an empty iterator.");for(let e=0;;){if(n[e].done){if(r[e]=t[e][Symbol.iterator](),n[e]=r[e].next(),++e>=r.length)return}else yield n.map(({value:s})=>s),e=0;n[e]=r[e].next()}}function*V({stop:t,start:r=0,step:n=1}){for(let e=r;e<t;e+=n)yield e}(()=>{for(var t=new Uint8Array(128),r=0;r<64;r++)t[r<26?r+65:r<52?r+71:r<62?r-4:r*4-205]=r;return n=>{for(var e=n.length,s=new Uint8Array((e-(n[e-1]=="=")-(n[e-2]=="="))*3/4|0),f=0,i=0;f<e;){var o=t[n.charCodeAt(f++)],c=t[n.charCodeAt(f++)],a=t[n.charCodeAt(f++)],w=t[n.charCodeAt(f++)];s[i++]=o<<2|c>>4,s[i++]=c<<4|a>>2,s[i++]=a<<6|w}return s}})();new TextEncoder;let u=new Uint8Array(128);for(let t=0;t<64;t++)u[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;function D(t){const r=t.length,n=new Uint8Array((r-(t[r-1]==="=")-(t[r-2]==="="))*3/4|0);for(let e=0,s=0;e<r;){const f=u[t.charCodeAt(e++)],i=u[t.charCodeAt(e++)],o=u[t.charCodeAt(e++)],c=u[t.charCodeAt(e++)];n[s++]=f<<2|i>>4,n[s++]=i<<4|o>>2,n[s++]=o<<6|c}return n}var l,h,d;const g=class g{constructor(r,n={}){p(this,l);p(this,h);p(this,d);y(this,l,r),y(this,h,n),y(this,d,n.overrides||{})}async get(r,n={}){let e=m(this,l).get(j(r));if(!e)return;if(typeof e=="string")return e.startsWith("base64:")?D(e.slice(7)):new TextEncoder().encode(e);let[s,f,i]=e,o=s??m(this,h).target;if(!o)throw Error(`No url for key ${r}, and no target url provided.`);let c=await k(O(o),f,i,$(m(this,d),n));if(c.status===200||c.status===206)return new Uint8Array(await c.arrayBuffer());throw new Error(`Request unsuccessful for key ${r}. Response status: ${c.status}.`)}static fromSpec(r,n){let e=N(r);return new g(e,n)}static async fromUrl(r,n){let e=await fetch(r,n==null?void 0:n.overrides).then(s=>s.json());return g.fromSpec(e,n)}};l=new WeakMap,h=new WeakMap,d=new WeakMap;let b=g;export{b as default,D as to_binary};
//# sourceMappingURL=ref-D_lF81zU.js.map
